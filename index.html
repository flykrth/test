<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Volunteer Scanner</title>

<script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>

<style>
body {
  font-family: Arial;
  text-align: center;
  background: #f5f5f5;
  padding: 20px;
}

#reader {
  width: 320px;
  margin: auto;
}

#result {
  font-size: 22px;
  margin-top: 20px;
  font-weight: bold;
}

.valid { color: green; }
.invalid { color: red; }

button {
  padding: 14px 28px;
  font-size: 16px;
  background: #ff4081;
  color: white;
  border: none;
  border-radius: 6px;
}
</style>
</head>

<body>

<h2>üéØ Holi Entry Scanner</h2>
<button onclick="startScanner()">Start Scanner</button>

<div id="reader"></div>
<div id="result"></div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbwtCC0bd8EHRzNe-HgSb0MlHB39ms1JvfxGR3L9rum7ub7UfqkBsV9aO0Kcc3Rguje-/exec";

let scannerStarted = false;
let lastScan = "";
let cooldown = false;

function startScanner() {
  if (scannerStarted) return;
  scannerStarted = true;

  const scanner = new Html5QrcodeScanner(
    "reader",
    {
      fps: 10,
      qrbox: 250,
      videoConstraints: { facingMode: { ideal: "environment" } }
    },
    false
  );

  scanner.render(onScanSuccess);
}

async function onScanSuccess(decodedText) {
  if (cooldown) return;
  if (decodedText === lastScan) return;

  lastScan = decodedText;
  cooldown = true;

  document.getElementById("result").innerHTML = "‚è≥ Verifying...";

  try {
    const formData = new URLSearchParams();
formData.append("qr", decodedText);

const res = await fetch(API_URL, {
  method: "POST",
  body: formData
});

    const data = await res.json();

    if (!data.valid) {
      document.getElementById("result").innerHTML =
        `<span class="invalid">${data.message}</span>`;
    } else {
      document.getElementById("result").innerHTML =
        `<span class="valid">
          ‚úÖ VALID ENTRY<br>
          Roll: ${data.roll}
        </span>`;
    }

  } catch (err) {
    document.getElementById("result").innerHTML =
      `<span class="invalid">‚ùå Network error</span>`;
  }

  setTimeout(() => cooldown = false, 1500);
}
</script>

</body>
</html>